name: allc2mz
num_nodes: 10
resources:
  cloud: gcp
  region: us-west1
  instance_type: n1-highcpu-96
#  use_spot: True
  disk_size: 250
  disk_tier: 'medium'
  image_id: projects/ecker-wding/global/images/myimage

file_mounts:
  ~/bmzip: ~/Projects/Github/bmzip

setup: |
  conda activate yap && cd ~/bmzip && python setup.py install

run: |
  conda activate yap
  bmzip copy_smk -o allc2mz.smk
  gsutil ls gs://mouse_pfc/allc/*.gz > allc.path.tsv
  split -n l/10 -d allc.path.tsv allc.path.
  echo "SkypilotNode: $SKYPILOT_NODE_RANK"
  echo "SkypilotNode: $SKYPILOT_NODE_RANK" > node
  echo 'snakemake --printshellcmds -s allc2mz.smk --config {indir} {outdir} {allc_path}".0$SKYPILOT_NODE_RANK" {reference} {ref_prefix} {chrom} {chrom_prefix} {gcp} --default-remote-prefix {bucket} --default-remote-provider GS --google-lifesciences-region us-west1 --scheduler greedy -j {cpu} -np' > cmd
  snakemake --printshellcmds -s allc2mz.smk --config {indir} {outdir} {allc_path}".0$SKYPILOT_NODE_RANK" {reference} {ref_prefix} {chrom} {chrom_prefix} {gcp} --default-remote-prefix {bucket} --default-remote-provider GS --google-lifesciences-region us-west1 --scheduler greedy -j {cpu}
  #--batch target_all=1/2 --immediate-submit --notemp